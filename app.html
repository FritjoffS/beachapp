<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Bjarke Beach - Turnering</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; background: #f0f0f0; margin: 0; }
    header {
      background: #009688; color: white; padding: 1rem;
      display: flex; justify-content: space-between; align-items: center;
    }
    header h1 {
      margin: 0; font-size: 1.5rem;
    }

    #logoutBtn {
      width: 100%;
      margin-top: 2rem;
      background: #f44336;
      color: white;
      padding: 0.7rem;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
    }
    

    main { max-width: 700px; margin: auto; padding: 1rem; background: #fff; }

    h2 { color: #009688; margin-top: 1.5rem; }
    input, button, select {
      width: 100%; padding: 0.6rem; margin: 0.3rem 0; font-size: 1rem; box-sizing: border-box;
    }
    button {
      background: #009688; color: white;
      border: none; cursor: pointer;
    }
    button:hover { opacity: 0.9; }

    ul { list-style: none; padding: 0; }
    li { padding: 0.3rem 0; display: flex; justify-content: space-between; align-items: center; }
    .remove-btn { color: red; cursor: pointer; margin-left: 8px; }

    #tournamentStatus {
      font-size: 0.95rem; color: #555; margin-bottom: 1rem;
    }
  </style>
</head>
<body>

<header>
  <h1>üèê Bjarke Beach Turnering</h1>  
</header>

<main>
  <h2>V√§lj / Skapa Turnering</h2>
  <input type="text" id="tournamentInput" placeholder="t.ex. 2025_01" />
  <button onclick="loadTournament()">Ladda turnering</button>
  <p id="tournamentStatus"></p>

  <h2>L√§gg till spelare</h2>
  <input type="text" id="playerName" placeholder="Spelarnamn" />
  <button onclick="addPlayer()">L√§gg till spelare</button>
  <ul id="playerList"></ul>

  <h2>Spelarstatistik</h2>
  <ul id="playerStats"></ul>

  <button id="logoutBtn" style="width: 100%; margin-top: 2rem; background: #f44336; color: white; padding: 0.7rem; border: none; border-radius: 5px; font-size: 1rem; cursor: pointer;">
    Logga ut
  </button>
  
</main>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  // ‚úÖ Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyACiD-vKZ0Jbe_8g7TPmuIOcep_yFERumU",
    authDomain: "bjarkebeach.firebaseapp.com",
    databaseURL: "https://bjarkebeach-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "bjarkebeach",
    storageBucket: "bjarkebeach.appspot.com",
    messagingSenderId: "8479008352",
    appId: "1:8479008352:web:4f7e2d6e758d2c7867c505"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();

  // üîê PROTECT THIS PAGE
  auth.onAuthStateChanged(user => {
    if (!user) {
      console.log("Ingen anv√§ndare inloggad. Skickar till login...");
      window.location.href = "login.html"; // redirect if not logged in
    } else {
      console.log("Inloggad som:", user.email);
    }
  });

  // üîì LOG OUT
 /* document.getElementById("logoutBtn").addEventListener("click", () => {
    auth.signOut().then(() => {
      console.log("Utloggad");
      window.location.href = "login.html";
    }).catch(err => {
      console.error("Fel vid utloggning:", err.message);
    });
  });
  */

  document.getElementById("logoutBtn").addEventListener("click", () => {
    auth.signOut().then(() => {
      window.location.href = "login.html";
    }).catch(err => {
      console.error("Fel vid utloggning:", err);
    });
  });
  

  // ‚úÖ Turnering + Spelardata
  let currentTournamentId = null;
  let players = [];

  function loadTournament() {
    const id = document.getElementById("tournamentInput").value.trim();
    if (!id) return alert("Skriv ett turnerings-ID");
    currentTournamentId = id;
    document.getElementById("tournamentStatus").textContent = "Laddar turnering: " + id + "...";

    const ref = db.ref("tournaments/" + currentTournamentId + "/players");
    ref.once("value").then(snapshot => {
      players = snapshot.val() || [];
      players.forEach(p => {
        p.matches = p.matches || 0;
        p.wins = p.wins || 0;
        p.losses = p.losses || 0;
        p.draws = p.draws || 0;
      });
      renderPlayers();
      updateStats();
    });

    document.getElementById("tournamentStatus").textContent = "‚úÖ Aktiv turnering: " + id;
  }

  function savePlayers() {
    if (!currentTournamentId) return;
    db.ref("tournaments/" + currentTournamentId + "/players").set(players);
  }

  function addPlayer() {
    const name = document.getElementById("playerName").value.trim();
    if (!name) return alert("Skriv ett namn.");
    if (players.find(p => p.name.toLowerCase() === name.toLowerCase()))
      return alert("Spelare finns redan.");
    const id = Date.now().toString(36) + Math.random().toString(36).substring(2, 6);
    players.push({ id, name, matches: 0, wins: 0, losses: 0, draws: 0 });
    document.getElementById("playerName").value = "";
    savePlayers();
    renderPlayers();
    updateStats();
  }

  function deletePlayer(id) {
    if (!confirm("Ta bort spelaren? Allt raderas.")) return;
    players = players.filter(p => p.id !== id);
    savePlayers();
    renderPlayers();
    updateStats();
  }

  function renderPlayers() {
    const ul = document.getElementById("playerList");
    ul.innerHTML = "";
    players.forEach(p => {
      const li = document.createElement("li");
      li.textContent = `${p.name} (${p.matches} matcher)`;
      const del = document.createElement("span");
      del.textContent = "üóëÔ∏è";
      del.className = "remove-btn";
      del.onclick = () => deletePlayer(p.id);
      li.appendChild(del);
      ul.appendChild(li);
    });
  }

  function updateStats() {
    const ul = document.getElementById("playerStats");
    ul.innerHTML = "";
    players.forEach(p => {
      const li = document.createElement("li");
      li.textContent = `${p.name}: Matcher: ${p.matches}, Vinster: ${p.wins}, F√∂rluster: ${p.losses}, Oavgjorda: ${p.draws}`;
      ul.appendChild(li);
    });
  }

</script>
</body>
</html>
