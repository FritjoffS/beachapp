<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Beach Volleyball Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; background: #f0f0f0; margin: 0; }
    header { background: #009688; color: white; text-align: center; padding: 1rem; font-size: 1.5rem; }
    main { max-width: 700px; margin: auto; padding: 1rem; background: #fff; }
    h2 { color: #009688; margin-top: 1.5rem; }
    input, button, select {
      width: 100%; padding: 0.6rem; margin: 0.3rem 0;
      font-size: 1rem; box-sizing: border-box;
    }
    button { background: #009688; color: white; border: none; cursor: pointer; }
    button:hover { opacity: 0.9; }
    ul { list-style: none; padding: 0; }
    li { padding: 0.3rem 0; display: flex; justify-content: space-between; }
    .remove-btn { color: red; cursor: pointer; margin-left: 8px; }
    .match-box { background: #e0f7fa; padding: 1rem; margin: 1rem 0; border-radius: 6px; }
  </style>
</head>
<body>

<header>üèê Beach Volleyball Match Manager</header>

<main>
  <h2>1. Add Players</h2>
  <input type="text" id="playerName" placeholder="Player name" />
  <button onclick="addPlayer()">Add Player</button>
  <ul id="playerList"></ul>

  <h2>2. Next Round</h2>
  <button onclick="generateNextRound()">Show Players for Next Match (8 players)</button>
  <div id="currentRound"></div>

  <h2>3. Enter Match Result</h2>
  <form onsubmit="event.preventDefault(); saveMatchResult();">
    <label for="winnerTeam">Who won?</label>
    <select id="winnerTeam" required>
      <option value="" disabled selected>Select winner</option>
      <option value="team1">Team 1</option>
      <option value="team2">Team 2</option>
      <option value="draw">Draw</option>
    </select>
    <button type="submit">Save Result</button>
  </form>

  <h2>4. Player Stats</h2>
  <ul id="playerStats"></ul>
</main>

<!-- Firebase v8 SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  // ‚úÖ Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyACiD-vKZ0Jbe_8g7TPmuIOcep_yFERumU",
    authDomain: "bjarkebeach.firebaseapp.com",
    databaseURL: "https://bjarkebeach-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "bjarkebeach",
    storageBucket: "bjarkebeach.firebasestorage.app",
    messagingSenderId: "8479008352",
    appId: "1:8479008352:web:4f7e2d6e758d2c7867c505",
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let players = [];
  let matchHistory = [];
  let currentPlayers = null;
  let roundNumber = 0;

  window.onload = () => {
    db.ref("players").once("value").then(snap => {
      players = snap.val() || [];
      players.forEach(p => { p.matches = p.matches || 0; });
      renderPlayers();
      updateStats();
    });
    db.ref("matches").once("value").then(snap => {
      matchHistory = snap.val() || [];
      roundNumber = matchHistory.length;
    });
  };

  function savePlayers() {
    db.ref("players").set(players);
  }

  function saveMatches() {
    db.ref("matches").set(matchHistory);
  }

  function addPlayer() {
    const nameInput = document.getElementById("playerName");
    const name = nameInput.value.trim();
    if (!name) return alert("Enter a player name.");
    if (players.find(p => p.name.toLowerCase() === name.toLowerCase()))
      return alert("This player already exists.");
    const id = Date.now().toString(36) + Math.random().toString(36).substring(2, 6);
    players.push({ id, name, matches: 0 });
    nameInput.value = "";
    savePlayers();
    renderPlayers();
    updateStats();
  }

  function deletePlayer(id) {
    if (!confirm("Are you sure? All stats will be cleared.")) return;
    players = players.filter(p => p.id !== id);
    matchHistory = [];
    roundNumber = 0;
    players.forEach(p => p.matches = 0);
    savePlayers();
    saveMatches();
    renderPlayers();
    updateStats();
    clearCurrentRound();
  }

  function renderPlayers() {
    const ul = document.getElementById("playerList");
    ul.innerHTML = "";
    players.forEach(p => {
      const li = document.createElement("li");
      li.textContent = `${p.name} (${p.matches} matches)`;
      const del = document.createElement("span");
      del.textContent = "üóëÔ∏è";
      del.className = "remove-btn";
      del.onclick = () => deletePlayer(p.id);
      li.appendChild(del);
      ul.appendChild(li);
    });
  }

  function updateStats() {
    const ul = document.getElementById("playerStats");
    ul.innerHTML = "";
    const standOversCount = {};
    players.forEach(p => { standOversCount[p.id] = 0; });

    matchHistory.forEach(match => {
      if (match.standingOver) {
        match.standingOver.forEach(p => {
          standOversCount[p.id] = (standOversCount[p.id] || 0) + 1;
        });
      }
    });

    players.forEach(p => {
      const li = document.createElement("li");
      li.textContent = `${p.name} ‚Äî Matches: ${p.matches} | Stood over: ${standOversCount[p.id] || 0}`;
      ul.appendChild(li);
    });
  }

  function shuffle(arr) {
    let array = arr.slice();
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function generateNextRound() {
    if (players.length < 8) return alert("At least 8 players required.");
    const sorted = shuffle(players).sort((a, b) => a.matches - b.matches);
    const playing = sorted.slice(0, 8);
    const standingOver = sorted.slice(8);
    currentPlayers = {
      playing,
      standingOver,
      roundNum: roundNumber + 1,
    };
    renderCurrentRound();
  }

  function renderCurrentRound() {
    const div = document.getElementById("currentRound");
    if (!currentPlayers) {
      div.innerHTML = "<p>No lineup. Click 'Show Players for Next Match'.</p>";
      return;
    }
    div.innerHTML = `
      <div class="match-box">
        <strong>Round ${currentPlayers.roundNum}</strong><br>
        <b>Playing:</b> ${currentPlayers.playing.map(p => p.name).join(", ")}<br>
        ${currentPlayers.standingOver.length > 0 ? `<b>Standing Over:</b> ${currentPlayers.standingOver.map(p => p.name).join(", ")}` : ""}
      </div>
    `;
  }

  function clearCurrentRound() {
    currentPlayers = null;
    document.getElementById("currentRound").innerHTML = "<p>No active round.</p>";
    document.getElementById("winnerTeam").value = "";
  }

  function saveMatchResult() {
    if (!currentPlayers) return alert("Generate next round first.");
    const result = document.getElementById("winnerTeam").value;
    if (!result) return alert("Select a result.");
    matchHistory.push({
      round: currentPlayers.roundNum,
      players: currentPlayers.playing.map(p => ({ id: p.id, name: p.name })),
      standingOver: currentPlayers.standingOver.map(p => ({ id: p.id, name: p.name })),
      winner: result,
      timestamp: new Date().toISOString()
    });
    currentPlayers.playing.forEach(p => {
      const found = players.find(x => x.id === p.id);
      if (found) found.matches = (found.matches || 0) + 1;
    });
    roundNumber++;
    saveMatches();
    savePlayers();
    renderPlayers();
    updateStats();
    clearCurrentRound();
  }

  clearCurrentRound();
</script>

</body>
</html>
